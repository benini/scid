
trigger:
- master

jobs:
- job: ubuntu_latest
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  - script: |
       sudo apt-get update &&
       sudo apt-get -y install tcl-dev tk-dev
    displayName: 'download tclt'
  - task: CMake@1
    inputs:
      workingDirectory: 'build'
      cmakeArgs: '-DGTEST=ON ..'
  - script: cmake --build build
  - script: build/gtest/scid_tests

- job: Windows_VS2019
  pool:
    vmImage: 'windows-latest'
  steps:
  - script: git clone --depth=1 https://github.com/microsoft/vcpkg.git
    displayName: Checkout vcpkg submodule
  - script: .\vcpkg\bootstrap-vcpkg.bat
    displayName: Bootstrap vcpkg
  - script: .\vcpkg\vcpkg.exe install tcl --triplet x64-windows --vcpkg-root .\vcpkg
    displayName: vcpkg install dependencies
  - script: mkdir build
    displayName: Make Build Directory
  - task: CMake@1
    inputs:
      workingDirectory: 'build'
      cmakeArgs: '-A x64 -DGTEST=ON -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake ..'
  - task: MSBuild@1
    inputs:
      solution: 'build/ALL_BUILD.vcxproj'
      maximumCpuCount: true
      platform: 'x64'
      configuration: 'Release'
  - task: CopyFiles@2
    inputs:
      Contents: '**\$(BuildConfiguration)\**\?(*.exe|*.dll|*.pdb)'
      targetFolder: $(Build.ArtifactStagingDirectory)
  - task: PublishBuildArtifacts@1
    inputs:
      pathToPublish: $(Build.ArtifactStagingDirectory)
      artifactName: MyBuildOutputs

- job: Windows_nmake
  pool:
    vmImage: 'windows-latest'
  steps:
  - script: git clone --depth=1 https://github.com/microsoft/vcpkg.git
    displayName: Checkout vcpkg submodule
  - script: .\vcpkg\bootstrap-vcpkg.bat
    displayName: Bootstrap vcpkg
  - script: .\vcpkg\vcpkg.exe install tcl --triplet x64-windows --vcpkg-root .\vcpkg
    displayName: vcpkg install dependencies
  - script: mkdir build
    displayName: Make Build Directory
  - task: CMake@1
    inputs:
      workingDirectory: 'build'
      cmakeArgs: '-A x64  -G"NMake Makefiles" -DCMAKE_INSTALL_PREFIX=install -DCMAKE_BUILD_TYPE=Release -DCMAKE_TOOLCHAIN_FILE=../vcpkg/scripts/buildsystems/vcpkg.cmake ..'
  - script: nmake VERBOSE=1 install
  - task: CopyFiles@2
    inputs:
      SourceFolder: '$(agent.builddirectory)\install'
      Contents: '**'
      TargetFolder: '$(build.artifactstagingdirectory)'
